from requests import session, get
from sys import argv
from random import randint

SERVER = argv[1]

# Cleaning DB
r = get(SERVER + "/init")
assert "Initialisation DONE!" in r.text

s = session()
username = str(randint(2 ** 27, 2 ** 28))
password = str(randint(2 ** 27, 2 ** 28))

data = {
    "username": username,
    "password": password
}
r = s.post(SERVER + "/register", data=data)

assert "Welcome" in r.text
assert username in r.text

params = {
    "search": "' -- "
}
r = s.get(SERVER + "/friends", params=params)

assert "Found 0" not in r.text

print("Success!")
s.close()
